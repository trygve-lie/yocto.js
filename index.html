<!doctype html>
<html>
<body>
</body>
<script src="src/yocto.js"></script>
<script>

/*

// Create DB - modifies the DB
var mydb = DB({name:''});								// return DB []

// Drop whole DB
mydb.drop();											// return empty [];

// Insert record to the DB - modified the DB
mydb.put({'foo': 'c'}, onPut);							// return new []
mydb.put([{'foo': 'd'}, {'foo': 'e'}], onPut);			// return new []

// Take matching records out of the DB
mydb.take({'foo': 'c'}, 30, onSuccess);						// return new []
mydb.take([{'foo': 'd'}, {'foo': 'e'}], 30, onSuccess);		// return new []



// Query the DB
mydb.get({foo : 'a'}, 30, onSuccess);					// return new []


// Query the DB and then sort the query
mydb.get({foo : 'a'}).sort('foo');						// return new []


// Query the DB and loop over each item
mydb.get({foo : 'a'}).forEach(function(item){
	console.log(item);
})


// Stats
mydb.size();									// return {records : num, fileSize : num}


*/




/**
 * Merges to arrays in order based on their natural
 * relationship.
 * @param {Array} left The first array to merge.
 * @param {Array} right The second array to merge.
 * @return {Array} The merged array.
 */
function merge(left, right){
    var result  = [],
        il      = 0,
        ir      = 0,
        v 		= result.length;


    while (il < left.length && ir < right.length){
        if (left[il] < right[ir]){
            result.push(left[il++]);
        } else {
            result.push(right[ir++]);
        }

        if(result.length < v) {
console.log('m');
        }



// console.log('il', il, 'ir', ir, 'result', result);
    }

    return result.concat(left.slice(il)).concat(right.slice(ir));
}

/**
 * Sorts an array in ascending natural order using
 * merge sort.
 * @param {Array} items The array to sort.
 * @return {Array} The sorted array.
 */
function mergeSort(items){

    if (items.length < 2) {
        return items;
    }

    var middle = Math.floor(items.length / 2),
        left    = items.slice(0, middle),
        right   = items.slice(middle),
        params = merge(mergeSort(left), mergeSort(right));

    // Add the arguments to replace everything between 0 and last item in the array
    params.unshift(0, items.length);
    items.splice.apply(items, params);
    return items;
}

/*
var g = [1,9,4,5,10,2,1,0];
console.log('g', g.length);

var h =mergeSort(g);
console.log(h);
*/









var mockA = [
	{id:0,gender:"F",first:"Kelly",last:"Ruth",city:"Dallas, TX",active:false},
	{id:1,gender:"M",first:"John",last:"Smith",city:"Seattle, WA",active:true},
	{id:2,gender:"F",first:"Babe",last:"Ruth",city:"Dallas, TX",active:false},
	{id:3,gender:"M",first:"Jeff",last:"Stevenson",city:"Washington, D.C.",active:true},
	{id:4,gender:"F",first:"Jennifer",last:"Gill",city:"Seattle, WA",active:true}
];

var mockB = [
	{id:5,gender:"F",first:"Siv",last:"Tessem",city:"Gjøvik",active:true},
	{id:6,gender:"F",first:"Live",last:"Glesne",city:"Oslo",active:true}
];

var mockC = [
	{id:7,gender:"F",first:"Hege",last:"Otterheim",city:"Gjøvik",active:true},
	'Error',
	['foo', 'bar'],
	{id:7,gender:"F",first:"Anita",last:"Lipsky",city:"Oslo",active:false},
];

var mockD = [
	{id:8,gender:"M",first:"Gregers Gram",last:"Rygg",city:"Oslo",active:true},
	{id:9,gender:"M",first:"Sveinung",last:"Rødsaker",city:"Oslo",active:false}
];



var db = yocto.db();

console.log('put =====================');

db.put(mockA, function(elements){
	console.log(elements);
});

console.log('put > each =====================');

db.put(mockB).each(function(element){
	console.log(element);
});

console.log('put > put > each =====================');

db.put(mockC).put(mockD).each(function(element){
	console.log(element);
});

console.log('get > save =====================');

db.get({gender:"M"}).save({name : 'test'}, function(elements){
	console.log(elements);
});

console.log('get =====================');

db.get({gender:"M"}, function(elements){
	console.log('callback', elements);
});

console.log('get(id:function) =====================');

db.get({gender:"M", id:function(element, is){
	return (element >= 3 && element <= 6);
}}, function(elements){
	console.log('callback', elements);
});

console.log('get > each =====================');

db.get({gender:"M"}).each(function(element){
	console.log('callback', element);
});

console.log('take > each =====================');

db.take({gender:"F"}).each(function(element){
	console.log('callback', element);
});

console.log('drop =====================');

db.drop(function(elements){
	console.log(db);
})


console.log('=====================');







/*
var m = Object.keys(template).every(function(key) {
	console.log('key', obj[key].indexOf(template[key]), obj[key].indexOf(template[key]) !== -1);
	return obj[key].indexOf(template[key]) !== -1;
});
*/
//console.log(m)







function insertionSort(items) {

    var len     = items.length,     // number of items in the array
        value,                      // the value currently being compared
        i,                          // index into unsorted section
        j;                          // index into sorted section

    for (i=0; i < len; i++) {

        // store the current value because it may shift later
        value = items[i];

        /*
         * Whenever the value in the sorted section is greater than the value
         * in the unsorted section, shift all items in the sorted section over
         * by one. This creates space in which to insert the value.
         */
        for (j=i-1; j > -1 && items[j] > value; j--) {
            items[j+1] = items[j];
        }
console.log(value, items[j+1]);
        items[j+1] = value;
    }

    return items;
}

/*

var nums = [13,4,6,2,20,5,6,3,0,6];
var n = insertionSort(nums);

var lets = ['b','k','f','i','e','c','g','h','d','j','a'];
var sl = insertionSort(lets);
console.log(sl);

*/





// var ydb = yocto.db();
/*
console.log('#### put > get > sort');

ydb.put(mockA).get({gender:'M'}).sort('first', function(records){
	console.log(records[0], records[1]);
})

console.log('#### get');

ydb.get({active: true}, function(records){
	console.log(records[0], records[1], records[2]);
})

console.log('#### sort');

ydb.sort('id', function(records){
	console.log(records[0], records[1], records[2], records[3]);
})

*/
// console.log('#### forEach');
// ydb.put(mockA);
/*
ydb.sort('id', function(e) {
	console.log('sorted');
});
*/




/*
ydb.put(mockA, function(records) {
	console.log('onPut A', records);
});

ydb.put(mockB, function(records) {
	console.log('onPut B', records);
});

ydb.put(mockC, function(records) {
	console.log('onPut C', records);
});

ydb.sort('first', function(records) {
	console.log('onSort', records);
})

ydb.get({gender: 'M'}, function(records) {
	console.log('onGet', records);
})

ydb.get({id: 4}, function(records) {
	console.log('onGet', records);
})
*/



/*

function DB(data) {
  if(!(this instanceof DB)){
    return new DB(data);
  }

  this.data = data || [];
  return this;
}

DB.prototype = {

  foo : function(val) {
    this.data.push(val);
    return this;
  },

  bar : function(val) {
    this.data.splice(val);
    return this;
  }

}

var a = DB(['a','b','d','c','f']).foo('h');
console.log('A', a);
a.bar(4);
console.log('A', a);



// #######################################################


function Que() {
	this.methods 	= [];
	this.response 	= null;
	this.flushed 	= false;
}

Que.prototype = {
	add : function(fn) {
		if (this.flushed) {
			fn.call(null, this.response);
		} else {
			this.methods.push(fn);
		}
	},

	flush : function(response) {
		if (this.flushed) {
			return;
		}

		this.response 	= response;
		this.flushed 	= true;

		while (this.methods[0]) {
			this.methods.shift()(response);
		}
	}
}



function Ydb(arr) {
	if(!(this instanceof Ydb)){
		return new Ydb(arr);
	}

	this.que = new Que;
	this.data = arr || [];

	var self = this;
}

Ydb.prototype = {

	foo : function(obj) {
		this.que.add(function(self){
			self.data.push(obj);
		})

		return this;
	},

	bar : function(index) {
		this.que.add(function(self){
			self.data.splice(index);
		})

		this.que.flush();

		return this;
	}

}


var b = Ydb(['a','b','d','c','f']).foo('g');
console.log(b);
b.bar(3);
console.log(b);






var a = yocto([{color:"blue",bar:"foo",n: 100},{color:"green",bar:"xyz", n: 4},{color:"red", n: 2},{color:"green", n: 90}]);

var DB();





var y = ydb([{color:"blue",bar:"foo",n: 100},{color:"green",bar:"xyz", n: 4},{color:"red", n: 2},{color:"green", n: 90}]);

console.log(y.VERSION);
var f = y.find({color : "green"}).sort();

console.log(f);
*/
</script>
</html>